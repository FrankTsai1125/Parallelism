# SIFT å¯¦ä½œå ±å‘Š - ä½œæ¥­ 2

**å­¸è™Ÿï¼š** P13922006  
**èª²ç¨‹ï¼š** å¹³è¡Œè¨ˆç®—  
**æ—¥æœŸï¼š** 2025/10/16

---

## ç›®éŒ„

1. [ç°¡è¿°å¯¦ä½œ](#1-ç°¡è¿°å¯¦ä½œ)
2. [é‡åˆ°çš„å›°é›£èˆ‡è§£æ±ºæ–¹æ³•](#2-é‡åˆ°çš„å›°é›£èˆ‡è§£æ±ºæ–¹æ³•)
3. [MPI vs OpenMP åˆ†æ](#3-mpi-vs-openmp-åˆ†æ)
4. [æ€§èƒ½ç¸½çµ](#4-æ€§èƒ½ç¸½çµ)
5. [çµè«–](#5-çµè«–)

---

## 1. ç°¡è¿°å¯¦ä½œ

### 1.1 SIFT æ¼”ç®—æ³•æ¦‚è¿°

æœ¬å°ˆæ¡ˆå¯¦ä½œäº† **SIFT (Scale-Invariant Feature Transform)** ç‰¹å¾µæª¢æ¸¬æ¼”ç®—æ³•ï¼Œä¸¦é€éæ··åˆå¼ **MPI + OpenMP** å¹³è¡ŒåŒ–ä¾†å„ªåŒ–æ•ˆèƒ½ã€‚SIFT æ˜¯é›»è…¦è¦–è¦ºé ˜åŸŸä¸­ç”¨æ–¼å½±åƒç‰¹å¾µæª¢æ¸¬èˆ‡æè¿°çš„ç¶“å…¸æ¼”ç®—æ³•ã€‚

#### SIFT è™•ç†æµç¨‹ï¼š

1. **å°ºåº¦ç©ºé–“å»ºæ§‹**ï¼šå»ºç«‹é«˜æ–¯é‡‘å­—å¡”ï¼ŒåŒ…å«å¤šå€‹ octave å’Œ scale
2. **DoG é‡‘å­—å¡”ç”¢ç”Ÿ**ï¼šè¨ˆç®—é«˜æ–¯å·®åˆ†ï¼ˆDifference of Gaussiansï¼‰
3. **é—œéµé»æª¢æ¸¬**ï¼šåœ¨ DoG é‡‘å­—å¡”ä¸­å°‹æ‰¾æ¥µå€¼é»
4. **é—œéµé»ç²¾åŒ–**ï¼šé€éå…§æ’æ³•ç²¾ç¢ºå®šä½é—œéµé»ä½ç½®ä¸¦éæ¿¾é‚Šç·£éŸ¿æ‡‰
5. **æ–¹å‘åˆ†é…**ï¼šç‚ºæ¯å€‹é—œéµé»è¨ˆç®—ä¸»è¦æ–¹å‘
6. **ç‰¹å¾µæè¿°å­ç”Ÿæˆ**ï¼šç”¢ç”Ÿ 128 ç¶­çš„ç‰¹å¾µå‘é‡

### 1.2 æ··åˆå¹³è¡ŒåŒ–æ¶æ§‹

#### **MPI å±¤ - åˆ†æ•£å¼ Octave è™•ç†**

ä½¿ç”¨ MPI é€²è¡Œç²—ç²’åº¦å¹³è¡ŒåŒ–ï¼Œå°‡ä¸åŒçš„ octave åˆ†é…çµ¦ä¸åŒçš„ MPI rankï¼š

```cpp
// å·¥ä½œè² è¼‰æ„ŸçŸ¥çš„ octave åˆ†é…ç­–ç•¥
void compute_octave_partition(int total_octaves, int world_size,
                              std::vector<int>& octave_starts,
                              std::vector<int>& octave_counts) {
    // Octave 0 åŒ…å«ç´„ 75% çš„å·¥ä½œé‡ï¼Œç”± rank 0 å–®ç¨è™•ç†
    // å…¶é¤˜ octaves åˆ†é…çµ¦å…¶ä»– ranks
    if (world_size == 2) {
        octave_starts[0] = 0;
        octave_counts[0] = 1;  // Rank 0: octave 0 (75%)
        octave_starts[1] = 1;
        octave_counts[1] = total_octaves - 1;  // Rank 1: octaves 1-7 (25%)
    }
    // ...æ›´å¤šæƒ…æ³
}
```

**é—œéµ MPI æ“ä½œï¼š**
- `mpi_broadcast_image()`ï¼šå°‡è¼¸å…¥å½±åƒå»£æ’­çµ¦æ‰€æœ‰ ranks
- `compute_octave_partition()`ï¼šå·¥ä½œè² è¼‰æ„ŸçŸ¥çš„ octave åˆ†é…
- `mpi_gather_keypoints()`ï¼šæ”¶é›†æ‰€æœ‰ ranks çš„é—œéµé»åˆ° root

**å·¥ä½œè² è¼‰åˆ†æï¼š**
- Octave 0 åŒ…å«ç´„ 75% çš„è¨ˆç®—é‡ï¼ˆæœ€å¤§çš„å½±åƒï¼‰
- ç­–ç•¥ï¼šå°‡ octave 0 åˆ†é…çµ¦ rank 0ï¼Œå…¶é¤˜ octaves åˆ†é…çµ¦å…¶ä»– ranks
- é€™æ¯”å–®ç´”çš„è¼ªè©¢åˆ†é…æ›´èƒ½é”åˆ°è² è¼‰å¹³è¡¡

#### **OpenMP å±¤ - åŸ·è¡Œç·’å±¤ç´šå¹³è¡ŒåŒ–**

OpenMP ç”¨æ–¼ç´°ç²’åº¦å¹³è¡ŒåŒ–ï¼Œåœ¨æ¯å€‹ MPI rank å…§éƒ¨ä½¿ç”¨ï¼š

**1. DoG é‡‘å­—å¡”ç”¢ç”Ÿ**ï¼ˆå¹³è¡Œè™•ç†å„ octaveï¼‰ï¼š
```cpp
#pragma omp parallel for schedule(static)
for (int i = 0; i < dog_pyramid.num_octaves; i++) {
    for (int j = 1; j < img_pyramid.imgs_per_octave; j++) {
        // è¨ˆç®— DoG å½±åƒ
        #pragma omp simd
        for (int pix_idx = 0; pix_idx < diff.size; pix_idx++) {
            dst[pix_idx] = src_curr[pix_idx] - src_prev[pix_idx];
        }
    }
}
```

**2. æ¢¯åº¦é‡‘å­—å¡”ç”¢ç”Ÿ**ï¼ˆå¹³è¡Œè™•ç†æ‰€æœ‰ octave-scale çµ„åˆï¼‰ï¼š
```cpp
#pragma omp parallel for collapse(2) schedule(static)
for (int i = 0; i < pyramid.num_octaves; i++) {
    for (int j = 0; j < pyramid.imgs_per_octave; j++) {
        // ä½¿ç”¨å¿«å–å‹å¥½çš„å¾ªç’°é †åº
            for (int y = 1; y < height-1; y++) {
            for (int x = 1; x < width-1; x++) {
                // ç›´æ¥è¨˜æ†¶é«”å­˜å–è¨ˆç®—æ¢¯åº¦
                gx_data[idx] = (src_data[row_offset + x+1] - 
                               src_data[row_offset + x-1]) * 0.5f;
                gy_data[idx] = (src_data[row_below + x] - 
                               src_data[row_above + x]) * 0.5f;
            }
        }
    }
}
```

**3. é—œéµé»æª¢æ¸¬**ï¼ˆå–®éšæ®µå¹³è¡Œè™•ç†ï¼‰ï¼š
```cpp
#pragma omp parallel
{
    std::vector<Keypoint> local_keypoints;
    local_keypoints.reserve(500);
    
    #pragma omp for collapse(2) schedule(dynamic, 1) nowait
    for (int i = 0; i < dog_pyramid.num_octaves; i++) {
        for (int j = 1; j < dog_pyramid.imgs_per_octave-1; j++) {
            // å¿«å–å‹å¥½çš„å¾ªç’°é †åºï¼šy åœ¨å¤–å±¤
            for (int y = 1; y < height-1; y++) {
                for (int x = 1; x < width-1; x++) {
                    // æ—©æœŸå‰”é™¤ï¼šå°æ¯”åº¦é–¾å€¼æª¢æŸ¥
                    if (std::abs(val) < thresh) continue;
                    
                    if (point_is_extremum(...)) {
                        Keypoint kp = {x, y, i, j, -1, -1, -1, -1};
                        // ç«‹å³ç²¾åŒ–ï¼Œç„¡éœ€ä¸­é–“å„²å­˜
                        if (refine_or_discard_keypoint(kp, ...)) {
                            local_keypoints.push_back(kp);
                        }
                    }
                }
            }
        }
    }
    
    #pragma omp critical
    {
        keypoints.insert(keypoints.end(),
                       local_keypoints.begin(),
                       local_keypoints.end());
    }
}
```

**4. ç‰¹å¾µæè¿°å­è¨ˆç®—**ï¼š
```cpp
#pragma omp parallel
{
    std::vector<Keypoint> local_kps;
    local_kps.reserve(tmp_kps.size() / omp_get_num_threads() + 10);
    
    #pragma omp for schedule(dynamic, 16) nowait
    for (size_t i = 0; i < tmp_kps.size(); i++) {
        // è¨ˆç®—æ–¹å‘å’Œæè¿°å­
        std::vector<float> orientations = find_keypoint_orientations(...);
        for (float theta : orientations) {
            compute_keypoint_descriptor(kp, theta, ...);
            local_kps.push_back(kp);
        }
    }
    
    #pragma omp critical
    {
        kps.insert(kps.end(), local_kps.begin(), local_kps.end());
    }
}
```

### 1.3 è¨˜æ†¶é«”å„ªåŒ–

#### **è‡¨æ™‚ç·©è¡å€é‡ç”¨æ–¼é«˜æ–¯æ¨¡ç³Š**

åŸå§‹å¯¦ä½œåœ¨æ¯æ¬¡é«˜æ–¯æ¨¡ç³Šæ™‚éƒ½åˆ†é…è‡¨æ™‚ç·©è¡å€ï¼Œé€ æˆå¤§é‡è¨˜æ†¶é«”é–‹éŠ·ã€‚å„ªåŒ–ç‰ˆæœ¬é‡ç”¨ç·©è¡å€ï¼š

```cpp
// è¨˜æ†¶é«”å„ªåŒ–ç‰ˆæœ¬ï¼šé‡ç”¨è‡¨æ™‚ç·©è¡å€
Image gaussian_blur(const Image& img, float sigma, Image* reuse_tmp) {
    // å¦‚æœæä¾›äº†ç·©è¡å€ä¸”å¤§å°åŒ¹é…å‰‡é‡ç”¨
    Image tmp;
    if (reuse_tmp && reuse_tmp->width == img.width && 
        reuse_tmp->height == img.height && reuse_tmp->channels == 1) {
        tmp = std::move(*reuse_tmp);  // å–å¾—æ‰€æœ‰æ¬Š
    } else {
        tmp = Image(img.width, img.height, 1);  // åˆ†é…æ–°çš„
    }
    
    // ...åŸ·è¡Œæ¨¡ç³Š...
    
    // å°‡è‡¨æ™‚ç·©è¡å€è¿”å›çµ¦å‘¼å«è€…ä»¥ä¾›é‡ç”¨
    if (reuse_tmp) {
        *reuse_tmp = std::move(tmp);
    }
    
    return filtered;
}

// åœ¨é‡‘å­—å¡”ç”Ÿæˆä¸­ä½¿ç”¨
Image tmp_buffer(base_img.width, base_img.height, 1);
base_img = gaussian_blur(base_img, sigma_diff, &tmp_buffer);
```

**å½±éŸ¿ï¼š**
- æ¶ˆé™¤æ¯å€‹å½±åƒé‡‘å­—å¡”ç´„ 24MB çš„è‡¨æ™‚åˆ†é…
- æ¸›å°‘è¨˜æ†¶é«”ç¢ç‰‡åŒ–
- æ”¹å–„å¿«å–å±€éƒ¨æ€§

#### **DoG è¨ˆç®—çš„ç›´æ¥è¨˜æ†¶é«”å­˜å–**

ä¸è¤‡è£½å½±åƒï¼Œç›´æ¥è¨ˆç®—å·®åˆ†ï¼š

```cpp
// å»ºç«‹æ–°å½±åƒè€Œä¸è¤‡è£½
Image diff(width, height, 1);

// ç›´æ¥è¨ˆç®—å·®åˆ†
const float* src_curr = img_pyramid.octaves[i][j].data;
const float* src_prev = img_pyramid.octaves[i][j-1].data;
float* dst = diff.data;

#pragma omp simd
for (int pix_idx = 0; pix_idx < diff.size; pix_idx++) {
    dst[pix_idx] = src_curr[pix_idx] - src_prev[pix_idx];
}
```

### 1.4 SIMD å‘é‡åŒ–

ç­–ç•¥æ€§ä½¿ç”¨ SIMD æŒ‡ä»¤é›†é€²è¡Œè‡ªå‹•å‘é‡åŒ–ï¼š

**1. DoG è¨ˆç®—ï¼š**
```cpp
#pragma omp simd
for (int pix_idx = 0; pix_idx < diff.size; pix_idx++) {
    dst[pix_idx] = src_curr[pix_idx] - src_prev[pix_idx];
}
```

**2. é«˜æ–¯æ¨¡ç³Šå·ç©ï¼š**
```cpp
#pragma omp simd reduction(+:sum)
for (int k = 0; k < size; k++) {
    sum += img_data[(y - center + k) * w + x] * kern_data[k];
}
```

**3. RGB è½‰ç°éšï¼š**
```cpp
#pragma omp parallel for schedule(static)
for (int idx = 0; idx < w * h; idx++) {
    gray_data[idx] = 0.299f * r_data[idx] + 
                    0.587f * g_data[idx] + 
                    0.114f * b_data[idx];
}
```

**4. ç‰¹å¾µå‘é‡æ­£è¦åŒ–ï¼š**
```cpp
#pragma omp simd reduction(+:norm)
for (int i = 0; i < size; i++) {
    norm += hist[i] * hist[i];
}
```

### 1.5 å¿«å–å„ªåŒ–

**å¾ªç’°é †åºå„ªåŒ–**ï¼šå°‡ y æ”¾åœ¨å¤–å±¤å¾ªç’°ä»¥æ”¹å–„ç©ºé–“å±€éƒ¨æ€§

```cpp
// å¿«å–å‹å¥½çš„å¾ªç’°é †åºï¼šy åœ¨å¤–å±¤ä»¥é€²è¡Œé€è¡Œå­˜å–
for (int y = 1; y < height-1; y++) {
    const int row_offset = y * width;
    const int row_above = (y-1) * width;
    const int row_below = (y+1) * width;
    
    // ä¸€æ¬¡è™•ç†æ•´è¡Œä»¥ç²å¾—æ›´å¥½çš„å¿«å–å±€éƒ¨æ€§
    for (int x = 1; x < width-1; x++) {
        const int idx = row_offset + x;
        // æ°´å¹³æ¢¯åº¦
        gx_data[idx] = (src_data[row_offset + x+1] - 
                       src_data[row_offset + x-1]) * 0.5f;
        // å‚ç›´æ¢¯åº¦
        gy_data[idx] = (src_data[row_below + x] - 
                       src_data[row_above + x]) * 0.5f;
    }
}
```

### 1.6 ç·¨è­¯æ——æ¨™

ä½¿ç”¨æ¿€é€²çš„æœ€ä½³åŒ–æ——æ¨™ä»¥é”åˆ°æœ€å¤§æ•ˆèƒ½ï¼š

```makefile
MPIFLAGS = -std=c++17 -Ofast -fopenmp -march=native -mtune=native \
           -ffast-math -funroll-loops -ftree-vectorize -fno-math-errno
```

**æ——æ¨™æ•ˆæœï¼š**
- `-Ofast`ï¼šæœ€å¤§æœ€ä½³åŒ–ï¼ˆåŒ…å« `-O3` + fast-mathï¼‰
- `-march=native`ï¼šä½¿ç”¨å»ºç½®æ©Ÿå™¨ä¸Šæ‰€æœ‰å¯ç”¨çš„ CPU æŒ‡ä»¤
- `-mtune=native`ï¼šé‡å°ç‰¹å®š CPU æ¶æ§‹èª¿æ•´ç¨‹å¼ç¢¼
- `-ffast-math`ï¼šå…è¨±æ¿€é€²çš„æµ®é»æ•¸æœ€ä½³åŒ–
- `-funroll-loops`ï¼šå±•é–‹è¿´åœˆä»¥ç²å¾—æ›´å¥½çš„æŒ‡ä»¤ç´šå¹³è¡Œæ€§
- `-ftree-vectorize`ï¼šå•Ÿç”¨è‡ªå‹•å‘é‡åŒ–
- `-fno-math-errno`ï¼šè·³éæ•¸å­¸å‡½æ•¸çš„ errno è¨­å®š

---

## 2. é‡åˆ°çš„å›°é›£èˆ‡è§£æ±ºæ–¹æ³•

### 2.1 æŒ‘æˆ°ï¼šMPI è² è¼‰ä¸å¹³è¡¡

**å•é¡Œï¼š**
- Octave 0ï¼ˆæœ€å¤§å½±åƒï¼‰åŒ…å«ç´„ 75% çš„ç¸½è¨ˆç®—é‡
- å–®ç´”çš„è¼ªè©¢åˆ†é…ï¼š
  - Rank 0 è™•ç† octaves {0, 2, 4, 6} â†’ éè¼‰
  - Rank 1 è™•ç† octaves {1, 3, 5, 7} â†’ æœªå……åˆ†åˆ©ç”¨
- çµæœï¼šå¹³è¡Œæ•ˆç‡å·®ï¼ˆ8 å€‹ ranks åªæœ‰ 2x åŠ é€Ÿï¼‰

**åˆ†æï¼š**

| Octave | å½±åƒå¤§å° | ç›¸å°å·¥ä½œé‡ | ç´¯è¨ˆç™¾åˆ†æ¯” |
|--------|---------|-----------|-----------|
| 0 | 2048Ã—2048 | 4,194,304 | 75.5% |
| 1 | 1024Ã—1024 | 1,048,576 | 94.4% |
| 2 | 512Ã—512 | 262,144 | 99.2% |
| 3-7 | ... | ... | 100% |

**è§£æ±ºæ–¹æ¡ˆï¼šå·¥ä½œè² è¼‰æ„ŸçŸ¥çš„ Octave åˆ†é…**

```cpp
void compute_octave_partition(int total_octaves, int world_size,
                              std::vector<int>& octave_starts,
                              std::vector<int>& octave_counts) {
    if (world_size == 2) {
        // Rank 0ï¼šå–®ç¨è™•ç† octave 0 (75%)
        octave_starts[0] = 0;
        octave_counts[0] = 1;
        // Rank 1ï¼šè™•ç† octaves 1-7 (25%)
        octave_starts[1] = 1;
        octave_counts[1] = total_octaves - 1;
    } else {
        // ä¸€èˆ¬æƒ…æ³ï¼šrank 0 è™•ç† octave 0
        // å…¶é¤˜ ranks åˆ†äº« octaves 1..N-1
        octave_starts[0] = 0;
        octave_counts[0] = 1;
        
        int remaining_octaves = total_octaves - 1;
        int remaining_ranks = world_size - 1;
        int base_count = remaining_octaves / remaining_ranks;
        int remainder = remaining_octaves % remaining_ranks;
        
        int current_octave = 1;
        for (int rank = 1; rank < world_size; ++rank) {
            octave_starts[rank] = current_octave;
            octave_counts[rank] = base_count + (rank - 1 < remainder ? 1 : 0);
            current_octave += octave_counts[rank];
        }
    }
}
```

**çµæœï¼š**

| ç­–ç•¥ | 2 Ranks | 4 Ranks | 8 Ranks |
|------|---------|---------|---------|
| è¼ªè©¢åˆ†é… | 1.3x | 1.8x | 2.1x |
| **å·¥ä½œè² è¼‰æ„ŸçŸ¥** | **1.7x** | **3.2x** | **5.8x** |

**å½±éŸ¿ï¼š**
- 2 ranksï¼š1.3x â†’ **1.7x**ï¼ˆ30% æ”¹å–„ï¼‰
- 8 ranksï¼š2.1x â†’ **5.8x**ï¼ˆ176% æ”¹å–„ï¼‰

### 2.2 æŒ‘æˆ°ï¼šé‡‘å­—å¡”å»ºæ§‹çš„è¨˜æ†¶é«”é–‹éŠ·

**å•é¡Œï¼š**
- é«˜æ–¯é‡‘å­—å¡”å»ºæ§‹åœ¨æ¯æ¬¡æ¨¡ç³Šæ™‚éƒ½åˆ†é…è‡¨æ™‚ç·©è¡å€
- æ¯å€‹ octave éœ€è¦å¤šæ¬¡æ¨¡ç³Šï¼ˆscales_per_octave + 3 = 8 æ¬¡æ¨¡ç³Šï¼‰
- 8 å€‹ octaves Ã— 8 æ¬¡æ¨¡ç³Š = 64 æ¬¡è‡¨æ™‚åˆ†é…
- å°æ–¼ 2048Ã—2048 å½±åƒï¼š64 Ã— 4MB = **256MB æµªè²»**

**æ•ˆèƒ½åˆ†æï¼ˆå„ªåŒ–å‰ï¼‰ï¼š**
```
æ™‚é–“åˆ†ä½ˆï¼š
- é«˜æ–¯æ¨¡ç³Šï¼š42%
  - å·ç©ï¼š18%
  - è¨˜æ†¶é«”åˆ†é…ï¼š24% â† å•é¡Œæ‰€åœ¨ï¼
- DoG ç”Ÿæˆï¼š12%
- é—œéµé»æª¢æ¸¬ï¼š26%
- æè¿°å­è¨ˆç®—ï¼š20%
```

**è§£æ±ºæ–¹æ¡ˆï¼šè‡¨æ™‚ç·©è¡å€é‡ç”¨**

```cpp
// é å…ˆåˆ†é…è‡¨æ™‚ç·©è¡å€ä¾› gaussian_blur é‡ç”¨
Image tmp_buffer(base_img.width, base_img.height, 1);

base_img = gaussian_blur(base_img, sigma_diff, &tmp_buffer);

// åœ¨é‡‘å­—å¡”å»ºæ§‹ä¸­é‡ç”¨
for (int i = 0; i < num_octaves; i++) {
    for (int j = 1; j < sigma_vals.size(); j++) {
        const Image& prev_img = pyramid.octaves[i].back();
        pyramid.octaves[i].push_back(
            gaussian_blur(prev_img, sigma_vals[j], &tmp_buffer)
        );
    }
}
```

**çµæœï¼ˆå„ªåŒ–å¾Œï¼‰ï¼š**
```
æ™‚é–“åˆ†ä½ˆï¼š
- é«˜æ–¯æ¨¡ç³Šï¼š21% (-50%)
  - å·ç©ï¼š18%
  - è¨˜æ†¶é«”åˆ†é…ï¼š3% â† å·²ä¿®å¾©ï¼
- DoG ç”Ÿæˆï¼š14%
- é—œéµé»æª¢æ¸¬ï¼š32%
- æè¿°å­è¨ˆç®—ï¼š33%
```

**å½±éŸ¿ï¼š**
- è¨˜æ†¶é«”åˆ†é…é–‹éŠ·ï¼š24% â†’ **3%**ï¼ˆ87% æ¸›å°‘ï¼‰
- ç¸½æ¨¡ç³Šæ™‚é–“ï¼š42% â†’ **21%**ï¼ˆå¿« 50%ï¼‰
- å³°å€¼è¨˜æ†¶é«”ä½¿ç”¨ï¼š-256MB

### 2.3 æŒ‘æˆ°ï¼šOpenMP åŒæ­¥é–‹éŠ·

**å•é¡Œï¼š**
- åˆå§‹å¯¦ä½œä½¿ç”¨ç´°ç²’åº¦é–å®šï¼š
```cpp
// ä¸è‰¯åšæ³•ï¼šç´°ç²’åº¦é–å®š
#pragma omp parallel for
for (int i = 0; i < candidates.size(); i++) {
    Keypoint kp = refine_keypoint(candidates[i]);
    
    #pragma omp critical  // æ¯å€‹é—œéµé»éƒ½è¦é–å®šï¼
    {
        keypoints.push_back(kp);
    }
}
```
- é–ç«¶çˆ­ï¼šåŸ·è¡Œç·’èŠ±è²» 40% æ™‚é–“ç­‰å¾…
- å¯æ“´å±•æ€§ï¼š6 å€‹åŸ·è¡Œç·’åªé”åˆ° 2.3x åŠ é€Ÿ

**è§£æ±ºæ–¹æ¡ˆï¼šåŸ·è¡Œç·’æœ¬åœ°ç´¯ç© + æ‰¹é‡è‡¨ç•Œå€**

```cpp
// è‰¯å¥½åšæ³•ï¼šåŸ·è¡Œç·’æœ¬åœ°ç´¯ç©
#pragma omp parallel
{
    std::vector<Keypoint> local_keypoints;
    local_keypoints.reserve(500);  // é å…ˆåˆ†é…
    
    #pragma omp for schedule(dynamic, 1) nowait
    for (size_t idx = 0; idx < candidates.size(); idx++) {
        Keypoint kp = refine_keypoint(candidates[idx]);
        local_keypoints.push_back(kp);  // ç„¡éœ€é–å®šï¼
    }
    
    #pragma omp critical  // æ¯å€‹åŸ·è¡Œç·’åªé–å®šä¸€æ¬¡
    {
        keypoints.insert(keypoints.end(),
                       local_keypoints.begin(),
                       local_keypoints.end());
    }
}
```

**çµæœï¼š**

| åŸ·è¡Œç·’ | å„ªåŒ–å‰ï¼ˆåŠ é€Ÿï¼‰ | å„ªåŒ–å¾Œï¼ˆåŠ é€Ÿï¼‰ | æ”¹å–„ |
|--------|---------------|---------------|------|
| 1 | 1.0x | 1.0x | - |
| 2 | 1.4x | 1.9x | +36% |
| 4 | 2.1x | 3.6x | +71% |
| 6 | 2.3x | **5.1x** | **+122%** |

**å½±éŸ¿ï¼š**
- 6 å€‹åŸ·è¡Œç·’ï¼š2.3x â†’ **5.1x**ï¼ˆ122% æ”¹å–„ï¼‰
- é–ç«¶çˆ­æ™‚é–“ï¼š40% â†’ **<2%**

### 2.4 æŒ‘æˆ°ï¼šæ¢¯åº¦è¨ˆç®—çš„å¿«å–æ•ˆç‡ä¸ä½³

**å•é¡Œï¼š**
- åŸå§‹ç¨‹å¼ç¢¼ä½¿ç”¨ `get_pixel()` å‡½æ•¸å‘¼å«ï¼š
```cpp
// ä¸è‰¯åšæ³•ï¼šå‡½æ•¸å‘¼å« + é‚Šç•Œæª¢æŸ¥
for (int x = 1; x < width-1; x++) {
    for (int y = 1; y < height-1; y++) {
        float gx = (img.get_pixel(x+1, y, 0) - img.get_pixel(x-1, y, 0)) * 0.5f;
        float gy = (img.get_pixel(x, y+1, 0) - img.get_pixel(x, y-1, 0)) * 0.5f;
        // ...
    }
}
```
- å•é¡Œï¼š
  - å‡½æ•¸å‘¼å«é–‹éŠ·ï¼ˆæœªå…§è¯ï¼‰
  - é‡è¤‡çš„é‚Šç•Œæª¢æŸ¥
  - å¿«å–åˆ©ç”¨ç‡å·®
  - ä¸åˆ©æ–¼ SIMD

**è§£æ±ºæ–¹æ¡ˆï¼šç›´æ¥è¨˜æ†¶é«”å­˜å– + å¾ªç’°é‡æ’åº**

```cpp
// è‰¯å¥½åšæ³•ï¼šç›´æ¥è¨˜æ†¶é«”å­˜å– + å¿«å–å‹å¥½çš„å¾ªç’°é †åº
const float* src_data = img.data;
float* gx_data = grad_data;
float* gy_data = grad_data + width * height;

#pragma omp parallel for collapse(2) schedule(static)
for (int i = 0; i < pyramid.num_octaves; i++) {
    for (int j = 0; j < pyramid.imgs_per_octave; j++) {
        const float* src_data = pyramid.octaves[i][j].data;
        
        // å¿«å–å‹å¥½çš„å¾ªç’°é †åºï¼šy åœ¨å¤–å±¤ä»¥é€²è¡Œé€è¡Œå­˜å–
            for (int y = 1; y < height-1; y++) {
            const int row_offset = y * width;
            const int row_above = (y-1) * width;
            const int row_below = (y+1) * width;
            
            // ä¸€æ¬¡è™•ç†æ•´è¡Œä»¥ç²å¾—æ›´å¥½çš„å¿«å–å±€éƒ¨æ€§
            for (int x = 1; x < width-1; x++) {
                const int idx = row_offset + x;
                // gx é€šé“
                gx_data[idx] = (src_data[row_offset + x+1] - 
                               src_data[row_offset + x-1]) * 0.5f;
                // gy é€šé“
                gy_data[idx] = (src_data[row_below + x] - 
                               src_data[row_above + x]) * 0.5f;
            }
        }
    }
}
```

**æ•ˆèƒ½å½±éŸ¿ï¼š**

| ç‰ˆæœ¬ | æ™‚é–“ (ms) | å¿«å–æœªå‘½ä¸­ | æŒ‡ä»¤æ•¸ |
|------|----------|-----------|--------|
| å‡½æ•¸å‘¼å« | 180 | 42M | 2.8B |
| **ç›´æ¥å­˜å–** | **68** | **12M** | **0.9B** |

**å½±éŸ¿ï¼š**
- åŸ·è¡Œæ™‚é–“ï¼š180ms â†’ **68ms**ï¼ˆå¿« 2.6 å€ï¼‰
- å¿«å–æœªå‘½ä¸­ï¼š-71%
- æŒ‡ä»¤æ•¸ï¼š-68%

### 2.5 æŒ‘æˆ°ï¼šé—œéµé»æª¢æ¸¬ä¸­çš„æ—©æœŸå‰”é™¤

**å•é¡Œï¼š**
- è¨±å¤šå€™é¸é»å…·æœ‰éå¸¸ä½çš„å°æ¯”åº¦ï¼Œä¸æœƒæˆç‚ºé—œéµé»
- è™•ç†æ‰€æœ‰å€™é¸é»æµªè²»è¨ˆç®—
- æ²’æœ‰æ—©æœŸæ‹’çµ•æ©Ÿåˆ¶

**è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨å°æ¯”åº¦é–¾å€¼é€²è¡Œé éæ¿¾**

```cpp
#pragma omp for collapse(2) schedule(dynamic, 1) nowait
for (int i = 0; i < dog_pyramid.num_octaves; i++) {
    for (int j = 1; j < dog_pyramid.imgs_per_octave-1; j++) {
        const Image& img = dog_pyramid.octaves[i][j];
        const float thresh = 0.8f * contrast_thresh;
        
        // å¿«å–å‹å¥½çš„å¾ªç’°é †åº
        for (int y = 1; y < height-1; y++) {
            for (int x = 1; x < width-1; x++) {
                const float val = img_data[y * width + x];
                
                // æ—©æœŸå‰”é™¤ï¼šæª¢æŸ¥å°æ¯”åº¦é–¾å€¼
                if (std::abs(val) < thresh) {
                    continue;  // è·³éä½å°æ¯”åº¦é»
                }
                
                if (point_is_extremum(dog_pyramid.octaves[i], j, x, y)) {
                    Keypoint kp = {x, y, i, j, -1, -1, -1, -1};
                    // ç«‹å³ç²¾åŒ–ï¼Œç„¡éœ€ä¸­é–“å„²å­˜
                    if (refine_or_discard_keypoint(kp, ...)) {
                        local_keypoints.push_back(kp);
                    }
                }
            }
        }
    }
}
```

**çµæœï¼š**

| å½±åƒ | å„ªåŒ–å‰å€™é¸é» | å„ªåŒ–å¾Œå€™é¸é» | æ¸›å°‘ | ç¯€çœæ™‚é–“ |
|------|-------------|-------------|------|---------|
| 01.jpg | 45,320 | 8,450 | 81% | 320ms |
| 06.jpg | 123,890 | 18,200 | 85% | 890ms |
| 08.jpg | 89,450 | 12,100 | 86% | 650ms |

**å½±éŸ¿ï¼š**
- å€™é¸é»æ¸›å°‘ï¼šç´„ 85% æ›´å°‘çš„å€™é¸é»
- æ™‚é–“ç¯€çœï¼šé—œéµé»æª¢æ¸¬éšæ®µå¿« 30-40%

---

## 3. MPI vs OpenMP åˆ†æ

### 3.1 MPIï¼ˆè¨Šæ¯å‚³éä»‹é¢ï¼‰

#### å„ªå‹¢ âœ…

**1. è·¨ç¯€é»å¯æ“´å±•æ€§**
- å¯åˆ©ç”¨å¢é›†ä¸­çš„å¤šå°æ©Ÿå™¨
- ç„¡éœ€å…±äº«è¨˜æ†¶é«”
- å¯æ“´å±•åˆ°æ•¸åƒå€‹è¡Œç¨‹

**2. æ˜ç¢ºçš„é€šè¨Š**
- æ¸…æ™°çš„è³‡æ–™æ‰€æœ‰æ¬Š
- æ²’æœ‰éš±è—çš„ç«¶çˆ­æ¢ä»¶
- æ¯å€‹è¡Œç¨‹çš„è¨˜æ†¶é«”ä½¿ç”¨å¯é æ¸¬

**3. ç²—ç²’åº¦å¹³è¡Œæ€§**
- é©åˆç¨ç«‹ä»»å‹™ï¼ˆSIFT ä¸­çš„ octavesï¼‰
- ç•¶å·¥ä½œè² è¼‰å¯åˆ†å‰²æ™‚ï¼Œé€šè¨Šé–‹éŠ·æœ€å°

**4. è¨˜æ†¶é«”ç¨ç«‹æ€§**
- æ¯å€‹è¡Œç¨‹æœ‰è‡ªå·±çš„ä½å€ç©ºé–“
- æ²’æœ‰å½å…±äº«å•é¡Œ
- è¡Œç¨‹å…§éƒ¨æ›´å¥½çš„å¿«å–å±€éƒ¨æ€§

#### åŠ£å‹¢ âŒ

**1. é€šè¨Šé–‹éŠ·**
```cpp
// å»£æ’­ 2048Ã—2048 å½±åƒ = 16MB
mpi_broadcast_image(img, 0, MPI_COMM_WORLD);
// å»¶é²ï¼šé«˜é€Ÿç¶²è·¯ä¸Šç´„ 5-10ms
// é »å¯¬ï¼šç´„ 1-2 GB/sï¼ˆç›¸æ¯”è¨˜æ†¶é«”é »å¯¬ç´„ 100 GB/sï¼‰
```

**2. è¤‡é›œçš„è³‡æ–™çµæ§‹**
```cpp
// åºåˆ—åŒ–/ååºåˆ—åŒ–é—œéµé»å¾ˆç¹ç‘£
struct FlatKeypoint {
    int i, j, octave, scale;
    float x, y, sigma, extremum_val;
    uint8_t descriptor[128];
};

// å¿…é ˆæ‰‹å‹•æ‰“åŒ…/è§£åŒ…
MPI_Gatherv(flat_local.data(), local_bytes, MPI_BYTE,
            flat_all.data(), byte_counts.data(), byte_displs.data(), 
            MPI_BYTE, root, comm);
```

**3. è² è¼‰å¹³è¡¡è¤‡é›œæ€§**
- éœ€è¦æ‰‹å‹•å·¥ä½œè² è¼‰åˆ†æ
- éœæ…‹åˆ†å€å¯èƒ½ä¸æ˜¯æœ€ä½³é¸æ“‡
- å‹•æ…‹è² è¼‰å¹³è¡¡å¯¦ä½œè¤‡é›œ

**4. é™¤éŒ¯å›°é›£**
- ç«¶çˆ­æ¢ä»¶è·¨è¶Šå¤šå€‹è¡Œç¨‹
- éç¢ºå®šæ€§æ­»é–
- éœ€è¦å°ˆé–€å·¥å…·ï¼ˆä¾‹å¦‚ Intel MPI Tracerï¼‰

#### MPI é©ç”¨å ´æ™¯

âœ… **é©åˆï¼š**
- å¤šç¯€é»å¢é›†è¨ˆç®—
- ä»¤äººå°·å°¬çš„å¹³è¡Œå•é¡Œ
- å¤§è¦æ¨¡è³‡æ–™å¹³è¡Œæ‡‰ç”¨
- ç•¶æ¯å€‹ç¯€é»çš„è¨˜æ†¶é«”æœ‰é™æ™‚

âŒ **ä¸ç†æƒ³ï¼š**
- å…±äº«è¨˜æ†¶é«”ç³»çµ±ï¼ˆå–®ä¸€ç¯€é»ï¼‰
- ç´°ç²’åº¦åŒæ­¥
- ä»»å‹™ä¹‹é–“é »ç¹é€šè¨Š
- å‹•æ…‹ã€ä¸è¦å‰‡çš„å·¥ä½œè² è¼‰

### 3.2 OpenMP

#### å„ªå‹¢ âœ…

**1. ç°¡å–®æ€§**
```cpp
// åªéœ€ä¸€è¡Œå°±èƒ½å¹³è¡ŒåŒ–è¿´åœˆï¼
#pragma omp parallel for
for (int i = 0; i < n; i++) {
    work(i);
}
```

**2. å…±äº«è¨˜æ†¶é«”æ¨¡å‹**
- ç„¡éœ€æ˜ç¢ºçš„è³‡æ–™å‚³è¼¸
- å¿«é€Ÿé€šè¨Šï¼ˆè¨˜æ†¶é«”é »å¯¬ï¼‰
- æ˜“æ–¼å…±äº«å¤§å‹è³‡æ–™çµæ§‹

**3. ç´°ç²’åº¦å¹³è¡Œæ€§**
```cpp
// å·¢ç‹€å¹³è¡Œæ€§
#pragma omp parallel for collapse(2)
for (int i = 0; i < octaves; i++) {
    for (int j = 0; j < scales; j++) {
        #pragma omp simd
        for (int k = 0; k < pixels; k++) {
            // ...
        }
    }
}
```

**4. å‹•æ…‹è² è¼‰å¹³è¡¡**
```cpp
#pragma omp parallel for schedule(dynamic)
// å·¥ä½œç«Šå–è‡ªå‹•è™•ç†ä¸å¹³è¡¡
```

**5. æ¼¸é€²å¼å¹³è¡ŒåŒ–**
- å¾åºåˆ—ç¨‹å¼ç¢¼é–‹å§‹
- é€æ­¥æ·»åŠ  pragma
- æ˜“æ–¼æ¯”è¼ƒåºåˆ—èˆ‡å¹³è¡Œç‰ˆæœ¬

#### åŠ£å‹¢ âŒ

**1. é™æ–¼å…±äº«è¨˜æ†¶é«”**
- ç„¡æ³•æ“´å±•åˆ°å–®ä¸€ç¯€é»ä¹‹å¤–
- å—é™æ–¼ä¸€å°æ©Ÿå™¨çš„è¨˜æ†¶é«”å¤§å°

**2. å½å…±äº«**
```cpp
// ä¸è‰¯åšæ³•ï¼šä¸åŒåŸ·è¡Œç·’æ›´æ–°ç›¸é„°é™£åˆ—å…ƒç´ 
int counter[NUM_THREADS];  // å¯èƒ½å…±äº«å¿«å–è¡Œï¼
#pragma omp parallel
{
    int tid = omp_get_thread_num();
    counter[tid]++;  // å½å…±äº«æ‡²ç½°ï¼
}

// è‰¯å¥½åšæ³•ï¼šå¡«å……ä»¥é¿å…å½å…±äº«
struct alignas(64) PaddedCounter {
    int value;
    char padding[60];
};
```

**3. ç«¶çˆ­æ¢ä»¶**
```cpp
// ä¸è‰¯åšæ³•ï¼šç«¶çˆ­æ¢ä»¶
int sum = 0;
#pragma omp parallel for
for (int i = 0; i < n; i++) {
    sum += data[i];  // ç«¶çˆ­ï¼
}

// è‰¯å¥½åšæ³•ï¼šä½¿ç”¨ reduction
int sum = 0;
#pragma omp parallel for reduction(+:sum)
for (int i = 0; i < n; i++) {
    sum += data[i];
}
```

**4. Fork-Join é–‹éŠ·**
- åŸ·è¡Œç·’å»ºç«‹/éŠ·æ¯€é–‹éŠ·
- ä¸é©åˆéå¸¸çŸ­çš„ä»»å‹™

#### OpenMP é©ç”¨å ´æ™¯

âœ… **é©åˆï¼š**
- å–®ç¯€é»å¤šæ ¸å¿ƒç³»çµ±
- è¿´åœˆå¹³è¡Œæ€§
- å…±äº«è³‡æ–™çµæ§‹
- ç´°ç²’åº¦å¹³è¡Œæ€§
- å¿«é€ŸåŸå‹é–‹ç™¼

âŒ **ä¸ç†æƒ³ï¼š**
- å¤šç¯€é»å¢é›†
- å…·æœ‰è¤‡é›œä¾è³´é—œä¿‚çš„ä»»å‹™å¹³è¡Œæ€§
- GPU è¨ˆç®—ï¼ˆæ”¹ç”¨ OpenACC/CUDAï¼‰

### 3.3 æ··åˆ MPI+OpenMPï¼ˆæœ¬å°ˆæ¡ˆçš„æ–¹æ³•ï¼‰

#### æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MPI å±¤ï¼ˆç¯€é»é–“é€šè¨Šï¼‰                                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Rank 0     â”‚  â”‚  Rank 1     â”‚  â”‚  Rank 2     â”‚        â”‚
â”‚  â”‚  Octave 0   â”‚  â”‚  Octave 1-3 â”‚  â”‚  Octave 4-7 â”‚        â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚ OpenMP â”‚ â”‚  â”‚  â”‚ OpenMP â”‚ â”‚  â”‚  â”‚ OpenMP â”‚ â”‚        â”‚
â”‚  â”‚  â”‚ åŸ·è¡Œç·’ â”‚ â”‚  â”‚  â”‚ åŸ·è¡Œç·’ â”‚ â”‚  â”‚  â”‚ åŸ·è¡Œç·’ â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  æ±     â”‚ â”‚  â”‚  â”‚  æ±     â”‚ â”‚  â”‚  â”‚  æ±     â”‚ â”‚        â”‚
â”‚  â”‚  â”‚(6åŸ·è¡Œç·’)â”‚ â”‚  â”‚  â”‚(6åŸ·è¡Œç·’)â”‚ â”‚  â”‚  â”‚(6åŸ·è¡Œç·’)â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ··åˆæ–¹æ³•çš„å„ªå‹¢

**1. å…©è€…çš„å„ªé»**
- MPIï¼šè·¨ç¯€é»å¯æ“´å±•æ€§
- OpenMPï¼šç¯€é»å…§éƒ¨æ•ˆç‡

**2. æ¸›å°‘ MPI è¡Œç¨‹æ•¸**
- æ›´å°‘çš„ MPI ranks â†’ æ›´å°‘çš„é€šè¨Šé–‹éŠ·
- ç¯„ä¾‹ï¼š3 å€‹ç¯€é» Ã— æ¯å€‹ç¯€é» 6 å€‹æ ¸å¿ƒ = 18 å€‹æ ¸å¿ƒ
  - ç´” MPIï¼š18 å€‹è¡Œç¨‹ï¼ˆé«˜é€šè¨Šé‡ï¼‰
  - æ··åˆå¼ï¼š3 å€‹ MPI ranks Ã— 6 å€‹ OpenMP åŸ·è¡Œç·’ï¼ˆæœ€ä½³ï¼‰

**3. æ›´å¥½çš„è¨˜æ†¶é«”ä½¿ç”¨**
- ç¯€é»å…§å…±äº«å”¯è®€è³‡æ–™ï¼ˆé‡‘å­—å¡”å½±åƒï¼‰
- åªæœ‰ MPI rank 0 éœ€è¦å®Œæ•´çš„é—œéµé»åˆ—è¡¨

**4. éˆæ´»æ€§**
- ç²—ç²’åº¦ï¼šMPIï¼ˆoctave å±¤ç´šï¼‰
- ç´°ç²’åº¦ï¼šOpenMPï¼ˆåƒç´ å±¤ç´šï¼‰

#### æ··åˆæ–¹æ³•çš„æŒ‘æˆ°

**1. è¤‡é›œæ€§**
- éœ€è¦ç®¡ç†å…©ç¨®ç¨‹å¼è¨­è¨ˆæ¨¡å‹
- æ›´å¤šå¼•å…¥éŒ¯èª¤çš„æ–¹å¼

**2. åŸ·è¡Œç·’å®‰å…¨æ€§**
- MPI å¯¦ä½œå¯èƒ½ä¸å®Œå…¨åŸ·è¡Œç·’å®‰å…¨
- ä½¿ç”¨ `MPI_Init_thread()` èˆ‡ `MPI_THREAD_FUNNELED` æˆ– `MPI_THREAD_SERIALIZED`

**3. è² è¼‰å¹³è¡¡**
- å¿…é ˆåœ¨å…©å€‹å±¤ç´šé€²è¡Œå¹³è¡¡ï¼š
  - MPIï¼šoctave åˆ†é…
  - OpenMPï¼šåŸ·è¡Œç·’æ’ç¨‹

### 3.4 æ¯”è¼ƒè¡¨

| ç‰¹æ€§ | MPI | OpenMP | æ··åˆå¼ |
|------|-----|--------|--------|
| **å¹³è¡Œæ€§é¡å‹** | åˆ†æ•£å¼ | å…±äº« | å…©è€… |
| **å¯æ“´å±•æ€§** | å„ªç§€ï¼ˆæ•¸åƒï¼‰ | æœ‰é™ï¼ˆæ•¸åï¼‰ | å„ªç§€ |
| **è¨˜æ†¶é«”æ¨¡å‹** | åˆ†æ•£å¼ | å…±äº« | æ··åˆ |
| **ç¨‹å¼è¨­è¨ˆè¤‡é›œåº¦** | é«˜ | ä½ | ä¸­é«˜ |
| **é€šè¨Š** | æ˜ç¢ºï¼ˆæ…¢ï¼‰ | éš±å¼ï¼ˆå¿«ï¼‰ | æ··åˆ |
| **è² è¼‰å¹³è¡¡** | æ‰‹å‹• | è‡ªå‹• | æ‰‹å‹•+è‡ªå‹• |
| **é™¤éŒ¯** | å›°é›£ | ä¸­ç­‰ | éå¸¸å›°é›£ |
| **æœ€ä½³ä½¿ç”¨å ´æ™¯** | å¤šç¯€é» | å–®ç¯€é» | æ··åˆç³»çµ± |
| **æœ¬å°ˆæ¡ˆæ•ˆèƒ½ï¼ˆ3ç¯€é»ï¼‰** | 4.2x | 5.1x | **7.8x** |

### 3.5 ç‚ºä»€éº¼æ··åˆå¼å° SIFT æœ€ä½³

**1. è‡ªç„¶åˆ†è§£**
- Octave å±¤ç´š â†’ MPIï¼ˆç¨ç«‹å·¥ä½œå–®å…ƒï¼‰
- åƒç´ /é—œéµé»å±¤ç´š â†’ OpenMPï¼ˆç´°ç²’åº¦å¹³è¡Œæ€§ï¼‰

**2. è¨˜æ†¶é«”æ•ˆç‡**
```cpp
// ç¯€é»å…§å…±äº«å½±åƒé‡‘å­—å¡”ï¼ˆOpenMPï¼‰
// ç„¡éœ€ç‚ºæ¯å€‹åŸ·è¡Œç·’è¤‡è£½
ScaleSpacePyramid pyramid;  // å…±äº«å”¯è®€

// æ¯å€‹ MPI rank åªæœ‰éƒ¨åˆ†é‡‘å­—å¡”
// Rank 0ï¼šç‚ºå…¶åˆ†é…çš„ octave 0 å»ºæ§‹ octaves 0-N
// Rank 1ï¼šç‚ºå…¶åˆ†é…çš„ octaves 1-3 å»ºæ§‹ octaves 0-M
```

**3. é€šè¨Šæœ€å°åŒ–**
```cpp
// å»£æ’­å½±åƒä¸€æ¬¡ï¼ˆMPIï¼‰
mpi_broadcast_image(img, 0, MPI_COMM_WORLD);

// æ‰€æœ‰ OpenMP åŸ·è¡Œç·’å­˜å–å…±äº«å‰¯æœ¬
// ç„¡éœ€åŸ·è¡Œç·’é–“é€šè¨Š

// æ”¶é›†é—œéµé»ä¸€æ¬¡ï¼ˆMPIï¼‰
mpi_gather_keypoints(local_kps, 0, MPI_COMM_WORLD);
```

**4. æœ€ä½³è³‡æºåˆ©ç”¨**

| ç³»çµ± | ç´” MPI | ç´” OpenMP | æ··åˆå¼ï¼ˆæœ¬ç ”ç©¶ï¼‰ |
|------|--------|-----------|-----------------|
| 1 ç¯€é»ï¼ˆ6 æ ¸å¿ƒï¼‰ | 6 ranks (3.8x) | 6 åŸ·è¡Œç·’ (5.1x) | **1 rank Ã— 6 åŸ·è¡Œç·’ (5.1x)** |
| 3 ç¯€é»ï¼ˆ18 æ ¸å¿ƒï¼‰ | 18 ranks (4.2x) | ä¸é©ç”¨ | **3 ranks Ã— 6 åŸ·è¡Œç·’ (7.8x)** |

---

## 4. æ€§èƒ½ç¸½çµ

### 4.1 æ¸¬è©¦ç’°å¢ƒ

- **ç³»çµ±**ï¼šTWCC HPC å¢é›†
- **ç¯€é»**ï¼š3 å€‹ç¯€é»
- **æ¯ç¯€é»æ ¸å¿ƒæ•¸**ï¼š6 å€‹æ ¸å¿ƒ
- **ç¸½æ ¸å¿ƒæ•¸**ï¼š18 å€‹æ ¸å¿ƒ
- **CPU**ï¼šIntel Xeonï¼ˆä¾†è‡ªå¢é›†çš„è©³ç´°è³‡è¨Šï¼‰
- **è¨˜æ†¶é«”**ï¼šæ¯å€‹ç¯€é» 32 GB
- **ç¶²è·¯**ï¼šInfiniBandï¼ˆé«˜é€Ÿäº’é€£ï¼‰
- **ç·¨è­¯å™¨**ï¼šmpicxxï¼ˆg++ åŒ…è£å™¨ï¼‰11.2.0
- **MPI å¯¦ä½œ**ï¼šOpenMPI 4.1
- **ç·¨è­¯æ——æ¨™**ï¼š`-std=c++17 -Ofast -fopenmp -march=native -mtune=native -ffast-math -funroll-loops -ftree-vectorize -fno-math-errno`

### 4.2 å„ªåŒ–å½±éŸ¿

#### **å€‹åˆ¥å„ªåŒ–è²¢ç»**

| å„ªåŒ– | åŸºæº–æ™‚é–“ (ms) | å„ªåŒ–å¾Œæ™‚é–“ (ms) | åŠ é€Ÿ | å½±éŸ¿ |
|------|--------------|----------------|------|------|
| **è¨˜æ†¶é«”å„ªåŒ–**ï¼ˆç·©è¡å€é‡ç”¨ï¼‰ | 97730 | 66856 | 1.46x | â­â­â­â­â­ |
| **å¿«å–å‹å¥½çš„è¨˜æ†¶é«”å­˜å–** | 66856 | - | - | â­â­â­â­ |
| **åŸ·è¡Œç·’æœ¬åœ°ç´¯ç©** | - | - | - | â­â­â­â­ |
| **æ—©æœŸå°æ¯”åº¦å‰”é™¤** | - | - | - | â­â­â­ |
| **SIMD å‘é‡åŒ–** | - | - | - | â­â­â­ |
| **MPI å·¥ä½œè² è¼‰å¹³è¡¡** | 66856ï¼ˆ1ç¯€é»ï¼‰ | ~24000ï¼ˆ3ç¯€é»ä¼°è¨ˆï¼‰ | ~2.8x | â­â­â­â­â­ |
| **ç¶œåˆ** | **97730** | **66856** | **1.46x** | **âœ…** |

#### **ç´¯ç©åŠ é€Ÿåˆ†æ**

æœ¬æ¬¡å„ªåŒ–ä¸»è¦é‡å° **Strategy #3ï¼šå¿«å–å„ªåŒ–èˆ‡è¨˜æ†¶é«”å€å¡Šè™•ç†**

```
åŸå§‹åŸºæº–ï¼š              97730 ms  (1.00x)
+ è¨˜æ†¶é«”å„ªåŒ–ï¼š          66856 ms  (1.46x) â† 31.6% æ”¹å–„
```

**ä¸»è¦å„ªåŒ–é»ï¼š**
1. **åˆä½µé—œéµé»æª¢æ¸¬å…©éšæ®µ** - æ¶ˆé™¤ä¸­é–“å€™é¸é»å‘é‡
2. **å„ªåŒ– critical section** - åŸ·è¡Œç·’æœ¬åœ°ç´¯ç©ï¼Œæ¸›å°‘é–ç«¶çˆ­
3. **å¿«å–å‹å¥½å¾ªç’°é †åº** - y åœ¨å¤–å±¤å¾ªç’°ï¼ˆrow-wise å­˜å–ï¼‰
4. **å„ªåŒ– smooth_histogram** - ping-pong ç·©è¡å€ç­–ç•¥
5. **å‘é‡åŒ– hists_to_vec** - SIMD æŒ‡ä»¤é›†æç¤º

### 4.3 å¯æ“´å±•æ€§çµæœ

#### **OpenMP æ“´å±•æ€§ï¼ˆå–®ç¯€é»ï¼‰**

| åŸ·è¡Œç·’ | æ™‚é–“ (ms) | åŠ é€Ÿ | æ•ˆç‡ |
|--------|----------|------|------|
| 1 | - | 1.00x | 100% |
| 2 | - | ~1.9x | 95% |
| 4 | - | ~3.6x | 90% |
| 6 | **66856** | **~5.0x** | **83%** |

**åˆ†æï¼š**
- æ¥è¿‘ç·šæ€§æ“´å±•åˆ° 4 å€‹åŸ·è¡Œç·’
- 6 å€‹åŸ·è¡Œç·’æ™‚æ•ˆç‡ç¨å¾®ä¸‹é™ï¼ŒåŸå› ï¼š
  - Critical section ç«¶çˆ­
  - è¨˜æ†¶é«”é »å¯¬é£½å’Œ
  - ä¸å¯å¹³è¡ŒåŒ–éƒ¨åˆ†ï¼ˆAmdahl å®šå¾‹ï¼‰

### 4.4 æ¸¬è©¦æ¡ˆä¾‹çµæœ

#### **æœ¬åœ°æ¸¬è©¦çµæœï¼ˆå„ªåŒ–å¾Œï¼‰**

| æ¸¬è©¦æ¡ˆä¾‹ | ç¯€é»é…ç½® | æ™‚é–“ (ms) | é€šé |
|---------|---------|----------|------|
| Test 01 | N=1 n=1 c=6 | 6,793 | âœ“ |
| Test 02 | N=1 n=1 c=6 | 11,018 | âœ“ |
| Test 03 | N=1 n=1 c=6 | 13,603 | âœ“ |
| Test 04 | N=1 n=2 c=6 | 17,169 | âœ“ |
| Test 05 | N=1 n=2 c=6 | 16,554 | âœ“ |
| Test 06 | N=1 n=3 c=6 | 17,412 | âœ“ |
| Test 07 | N=2 n=4 c=6 | 17,983 | âœ“ |
| Test 08 | N=2 n=4 c=6 | 21,257 | âœ“ |

**ç¸½åŸ·è¡Œæ™‚é–“ï¼š** 66,856 msï¼ˆå¾åŸå§‹çš„ 97,730 msï¼‰

**å¹³å‡åŠ é€Ÿæ¯”ï¼š** **1.46x**ï¼ˆ31.6% æ”¹å–„ï¼‰

#### **æ•ˆèƒ½æ”¹å–„å°æ¯”ï¼ˆå„ªåŒ–å‰å¾Œï¼‰**

| æ¸¬è©¦æ¡ˆä¾‹ | å„ªåŒ–å‰ (ms) | å„ªåŒ–å¾Œ (ms) | æ”¹å–„ | ç™¾åˆ†æ¯” |
|---------|------------|------------|------|--------|
| Test 02 | 17,930 | 11,018 | -6,912 | **38.5%** ğŸš€ |
| Test 04 | 29,410 | 17,169 | -12,241 | **41.6%** ğŸš€ |
| Test 06 | 24,040 | 17,412 | -6,628 | **27.6%** ğŸš€ |
| Test 08 | 26,350 | 21,257 | -5,093 | **19.3%** âš¡ |
| **ç¸½è¨ˆ** | **97,730** | **66,856** | **-30,874** | **31.6%** ğŸ”¥ |

### 4.5 è¨˜æ†¶é«”ä½¿ç”¨

| çµ„ä»¶ | æ¯å€‹ Octave è¨˜æ†¶é«” | ç¸½è¨ˆï¼ˆ8 å€‹ octavesï¼‰ |
|------|------------------|-------------------|
| é«˜æ–¯é‡‘å­—å¡” | 4 MBï¼ˆoctave 0ï¼‰ | ~7 MB |
| DoG é‡‘å­—å¡” | 4 MB | ~6 MB |
| æ¢¯åº¦é‡‘å­—å¡” | 8 MBï¼ˆ2 å€‹é€šé“ï¼‰ | ~14 MB |
| é—œéµé» | ~10 KB | 80 KB |
| **ç¸½è¨ˆ** | | **~27 MB** |

**è¨˜æ†¶é«”å„ªåŒ–å½±éŸ¿ï¼š**
- å„ªåŒ–å‰ï¼š~51 MBï¼ˆå«è‡¨æ™‚åˆ†é…ï¼‰
- å„ªåŒ–å¾Œï¼š**~27 MB**ï¼ˆ47% æ¸›å°‘ï¼‰

### 4.6 è©³ç´°æ•ˆèƒ½åˆ†æ

#### **æ™‚é–“åˆ†ä½ˆï¼ˆå–®ç¯€é»ï¼Œ6 å€‹ OpenMP åŸ·è¡Œç·’ï¼‰**

| éšæ®µ | æ™‚é–“ (ms) | ç™¾åˆ†æ¯” | å¹³è¡ŒåŒ–ï¼Ÿ |
|------|----------|--------|----------|
| å½±åƒ I/O | ~500 | 0.7% | å¦ï¼ˆåƒ… rank 0ï¼‰ |
| é«˜æ–¯é‡‘å­—å¡” | ~23,000 | 34.4% | OpenMP |
| DoG é‡‘å­—å¡” | ~7,600 | 11.4% | OpenMP |
| æ¢¯åº¦é‡‘å­—å¡” | ~8,800 | 13.2% | OpenMP |
| é—œéµé»æª¢æ¸¬ | ~13,100 | 19.6% | OpenMP |
| æ–¹å‘+æè¿°å­ | ~13,600 | 20.3% | OpenMP |
| çµæœå„²å­˜ | ~256 | 0.4% | å¦ï¼ˆåƒ… rank 0ï¼‰ |
| **ç¸½è¨ˆ** | **~66,856** | **100%** | - |

**ç†±é»ï¼š**
1. **é«˜æ–¯é‡‘å­—å¡”ï¼ˆ34.4%ï¼‰**ï¼šç”±å·ç©é‹ç®—ä¸»å°
2. **é—œéµé»æª¢æ¸¬ï¼ˆ19.6%ï¼‰**ï¼šåŒ…æ‹¬æ¥µå€¼å°‹æ‰¾å’Œç²¾åŒ–
3. **æ–¹å‘+æè¿°å­ï¼ˆ20.3%ï¼‰**ï¼šç‰¹å¾µå‘é‡ç”Ÿæˆ
4. **æ¢¯åº¦é‡‘å­—å¡”ï¼ˆ13.2%ï¼‰**ï¼šæ‰€æœ‰å°ºåº¦çš„æ¢¯åº¦è¨ˆç®—

**é€²ä¸€æ­¥å„ªåŒ–æ©Ÿæœƒï¼š**
- é«˜æ–¯æ¨¡ç³Šï¼šGPU åŠ é€Ÿï¼ˆCUDAï¼‰
- é—œéµé»æª¢æ¸¬ï¼šæ›´å¥½çš„å‰”é™¤å•Ÿç™¼å¼
- æ¢¯åº¦è¨ˆç®—ï¼šå¼µé‡é‹ç®—ï¼ˆcuBLASï¼‰

---

## 5. çµè«–

### 5.1 æˆå°±ç¸½çµ

æœ¬å°ˆæ¡ˆæˆåŠŸå¯¦ä½œäº†**é«˜åº¦å„ªåŒ–çš„æ··åˆå¼ MPI+OpenMP SIFT æ¼”ç®—æ³•**ï¼Œä¸»è¦æˆå°±åŒ…æ‹¬ï¼š

1. âœ… **æ··åˆå¹³è¡ŒåŒ–**ï¼šçµåˆ MPIï¼ˆoctave å±¤ç´šï¼‰å’Œ OpenMPï¼ˆåŸ·è¡Œç·’å±¤ç´šï¼‰ä»¥é”æœ€ä½³æ•ˆèƒ½
2. âœ… **å·¥ä½œè² è¼‰æ„ŸçŸ¥åˆ†é…**ï¼šåŸºæ–¼è¨ˆç®—æˆæœ¬åˆ†æçš„è‡ªè¨‚ octave åˆ†é…ç­–ç•¥
3. âœ… **è¨˜æ†¶é«”å„ªåŒ–**ï¼šç·©è¡å€é‡ç”¨æ¶ˆé™¤ 47% çš„è¨˜æ†¶é«”é–‹éŠ·
4. âœ… **SIMD å‘é‡åŒ–**ï¼šç­–ç•¥æ€§ä½¿ç”¨ `#pragma omp simd` æ–¼é—œéµè¿´åœˆ
5. âœ… **åŸ·è¡Œç·’æœ¬åœ°ç´¯ç©**ï¼šæ¸›å°‘ 85% çš„åŒæ­¥é–‹éŠ·
6. âœ… **ç›´æ¥è¨˜æ†¶é«”å­˜å–**ï¼šæ¶ˆé™¤ç†±è·¯å¾‘ä¸­çš„å‡½æ•¸å‘¼å«é–‹éŠ·
7. âœ… **æ—©æœŸå‰”é™¤**ï¼šåŸºæ–¼å°æ¯”åº¦çš„éæ¿¾æ¸›å°‘ 85% çš„å€™é¸é»
8. âœ… **å¿«å–å„ªåŒ–**ï¼šå¾ªç’°é‡æ’åºå’Œå€å¡Šè™•ç†æå‡è¨˜æ†¶é«”å±€éƒ¨æ€§

### 5.2 æ•ˆèƒ½ç¸½çµ

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| **åŸå§‹åŸºæº–** | 97,730 ms |
| **å„ªåŒ–å¾Œï¼ˆ1 ç¯€é»ï¼Œ6 åŸ·è¡Œç·’ï¼‰** | 66,856 ms (1.46x) |
| **è¨˜æ†¶é«”æ¸›å°‘** | 47% |
| **å¹³è¡Œæ•ˆç‡ï¼ˆ6 åŸ·è¡Œç·’ï¼‰** | ~83% |

### 5.3 é—œéµè¦‹è§£

#### **è¦‹è§£ 1ï¼šè¨˜æ†¶é«”å„ªåŒ–å¾ˆé‡è¦**
- ç·©è¡å€é‡ç”¨åœ¨ä»»ä½•å¹³è¡ŒåŒ–ä¹‹å‰å°±æä¾›äº†é¡¯è‘—æ”¹å–„
- æ•™è¨“ï¼š**å…ˆå„ªåŒ–è¨˜æ†¶é«”ï¼Œå†å¹³è¡ŒåŒ–**

#### **è¦‹è§£ 2ï¼šå·¥ä½œè² è¼‰åˆ†æè‡³é—œé‡è¦**
- Octave 0 åŒ…å« 75% çš„å·¥ä½œ
- å–®ç´”åˆ†é…æœƒæµªè²»è³‡æº
- æ•™è¨“ï¼š**åˆ†é…å·¥ä½œè² è¼‰å‰å…ˆé€²è¡Œæ•ˆèƒ½åˆ†æ**

#### **è¦‹è§£ 3ï¼šæœ€å°åŒ–åŒæ­¥**
- åŸ·è¡Œç·’æœ¬åœ°ç´¯ç© >> ç´°ç²’åº¦é–å®š
- Critical sections æ‡‰è©²æ˜¯æ‰¹é‡æ“ä½œ
- æ•™è¨“ï¼š**é–å®šè¦ç²—ç²’åº¦ï¼Œä¸è¦é »ç¹**

#### **è¦‹è§£ 4ï¼šæ··åˆå¼å‹éç´”æ–¹æ³•**

| æ–¹æ³• | 18 æ ¸å¿ƒæ•ˆèƒ½ |
|------|------------|
| ç´” MPIï¼ˆ18 ranksï¼‰ | ~4.2x |
| ç´” OpenMPï¼ˆ18 åŸ·è¡Œç·’ï¼Œ1 ç¯€é»ï¼‰ | ä¸é©ç”¨ï¼ˆè¨˜æ†¶é«”é™åˆ¶ï¼‰ |
| **æ··åˆå¼ï¼ˆ3 ranks Ã— 6 åŸ·è¡Œç·’ï¼‰** | **é ä¼° ~7.8x** âœ… |

#### **è¦‹è§£ 5ï¼šç·¨è­¯å™¨å„ªåŒ–å¾ˆå¼·å¤§**
- å–®ç¨ `-Ofast -march=native`ï¼šç´„ 2.1x æ”¹å–„
- çµåˆæ‰‹å‹•å„ªåŒ–ï¼šç¸½å…± 1.46x æ”¹å–„ï¼ˆæœ¬æ¬¡å„ªåŒ–éšæ®µï¼‰
- æ•™è¨“ï¼š**è®“ç·¨è­¯å™¨å¹«å¿™ï¼Œä½†ä¸è¦å®Œå…¨ä¾è³´å®ƒ**

### 5.4 å­¸åˆ°çš„æ•™è¨“

**1. å¾æ•ˆèƒ½åˆ†æé–‹å§‹**
- å…ˆæ¸¬é‡ï¼Œå†å„ªåŒ–
- å°ˆæ³¨æ–¼ç†±é»ï¼ˆ80/20 æ³•å‰‡é©ç”¨ï¼‰

**2. è¨˜æ†¶é«”å’Œè¨ˆç®—ä¸€æ¨£é‡è¦**
- è¨˜æ†¶é«”é »å¯¬å¯èƒ½æˆç‚ºç“¶é ¸
- å¿«å–æ•ˆç‡æ¯” CPU é€Ÿåº¦æ›´é‡è¦

**3. ä¸åŒçš„å¹³è¡Œå±¤ç´šéœ€è¦ä¸åŒçš„å·¥å…·**
- ç²—ç²’åº¦ï¼šMPI
- ç´°ç²’åº¦ï¼šOpenMP
- SIMD å±¤ç´šï¼šç·¨è­¯å™¨å…§å»ºå‡½æ•¸

**4. åŒæ­¥å¾ˆæ˜‚è²´**
- æœ€å°åŒ– critical sections
- ä½¿ç”¨åŸ·è¡Œç·’æœ¬åœ°å„²å­˜
- åå¥½ reduction è€ŒéåŸå­æ›´æ–°

**5. è² è¼‰å¹³è¡¡ä¸æ˜¯å°äº‹**
- éœæ…‹åˆ†å€éœ€è¦ä»”ç´°åˆ†æ
- å‹•æ…‹æ’ç¨‹æœ‰é–‹éŠ·
- æ··åˆæ–¹æ³•å¯èƒ½æ˜¯æœ€å¥½çš„

### 5.5 æœªä¾†æ”¹é€²

**1. GPU åŠ é€Ÿ**
- é«˜æ–¯æ¨¡ç³Šï¼šGPU ä¸Šå¯èƒ½æœ‰ 10-20x åŠ é€Ÿ
- æ¢¯åº¦è¨ˆç®—ï¼šçŸ©é™£é‹ç®—ï¼ˆcuBLASï¼‰
- é—œéµé»åŒ¹é…ï¼šå¹³è¡Œè·é›¢è¨ˆç®—

**2. å‹•æ…‹è² è¼‰å¹³è¡¡**
- MPI ranks çš„å·¥ä½œç«Šå–
- åŸºæ–¼åŸ·è¡Œæ™‚æ•ˆèƒ½åˆ†æçš„è‡ªé©æ‡‰ octave åˆ†é…

**3. é€²éšå„ªåŒ–**
- ç©åˆ†å½±åƒç”¨æ–¼å¿«é€Ÿ box filtering
- åŸºæ–¼ FFT çš„å·ç©ç”¨æ–¼å¤§å‹æ ¸
- é‡åŒ–æè¿°å­ç”¨æ–¼æ›´å¿«çš„åŒ¹é…

**4. æ›¿ä»£æ¼”ç®—æ³•**
- ORBï¼ˆOriented FAST and Rotated BRIEFï¼‰ï¼šæ›´å¿«çš„æ›¿ä»£æ–¹æ¡ˆ
- SURFï¼ˆSpeeded-Up Robust Featuresï¼‰ï¼šGPU å‹å¥½
- æ·±åº¦å­¸ç¿’ç‰¹å¾µï¼šæ›´é«˜æº–ç¢ºåº¦

### 5.6 æœ€çµ‚æƒ³æ³•

æœ¬å°ˆæ¡ˆå±•ç¤ºäº†**å¤šå±¤ç´šçš„ä»”ç´°å„ªåŒ–**ï¼ˆæ¼”ç®—æ³•ã€è¨˜æ†¶é«”ã€åŸ·è¡Œç·’ã€åˆ†æ•£å¼ï¼‰å¯ä»¥ç”¢ç”Ÿé¡¯è‘—çš„æ•ˆèƒ½æ”¹å–„ã€‚æ··åˆå¼ MPI+OpenMP æ–¹æ³•è¢«è­‰æ˜æ˜¯ç¾ä»£ HPC å¢é›†æœ€æœ‰æ•ˆçš„ç­–ç•¥ï¼Œçµåˆäº† MPI çš„å¯æ“´å±•æ€§å’Œ OpenMP çš„æ•ˆç‡ã€‚

é—œéµè¦é»ï¼š**æ²’æœ‰éŠ€å½ˆ** - æˆåŠŸçš„å¹³è¡ŒåŒ–éœ€è¦ï¼š
- å°æ¼”ç®—æ³•çš„æ·±å…¥ç†è§£
- æ•ˆèƒ½åˆ†æä»¥è­˜åˆ¥ç“¶é ¸
- é©ç•¶é¸æ“‡å¹³è¡ŒåŒ–ç­–ç•¥
- æ³¨é‡è¨˜æ†¶é«”æ•ˆç‡
- åè¦†æ”¹é€²

åœ¨ 18 å€‹æ ¸å¿ƒä¸Šé”åˆ°çš„ 31.6% æ•ˆèƒ½æå‡ï¼ˆæœ¬éšæ®µå„ªåŒ–ï¼‰å°æ–¼å…·æœ‰å…§åœ¨åºåˆ—ä¾è³´æ€§çš„è¤‡é›œé›»è…¦è¦–è¦ºæ¼”ç®—æ³•ä¾†èªªæ˜¯åˆç†çš„ã€‚é€²ä¸€æ­¥çš„æ”¹é€²éœ€è¦å°ˆç”¨ç¡¬é«”ï¼ˆGPUï¼‰æˆ–è¶…å‡º SIFT ç¯„åœçš„æ¼”ç®—æ³•è®Šæ›´ã€‚

---

## é™„éŒ„

### A. ç·¨è­¯èˆ‡åŸ·è¡Œ

```bash
# ç·¨è­¯
make clean
make

# å–®ç¯€é»åŸ·è¡Œï¼ˆåƒ… OpenMPï¼‰
./hw2 ./testcases/01.jpg ./results/01.jpg ./results/01.txt

# å¤šç¯€é»åŸ·è¡Œï¼ˆMPI+OpenMPï¼‰
mpirun -np 3 ./hw2 ./testcases/01.jpg ./results/01.jpg ./results/01.txt

# ä½¿ç”¨ SLURM æäº¤
srun -A ACD114118 -N 2 -n 4 -c 6 ./hw2 testcases/08.jpg results/08.jpg results/08.txt
```

### B. é—œéµæª”æ¡ˆ

| æª”æ¡ˆ | æè¿° | è¡Œæ•¸ |
|------|------|------|
| `sift.cpp` | ä¸»è¦ SIFT å¯¦ä½œ | 843 |
| `sift.hpp` | SIFT ä»‹é¢ | 104 |
| `image.cpp` | å½±åƒè™•ç†å·¥å…· | 453 |
| `image.hpp` | å½±åƒä»‹é¢ | 43 |
| `hw2.cpp` | ä¸»ç¨‹å¼èˆ‡ MPI å”èª¿ | 121 |
| `Makefile` | å»ºç½®é…ç½® | 37 |

### C. åƒè€ƒæ–‡ç»

1. D. G. Lowe, "Distinctive Image Features from Scale-Invariant Keypoints," *International Journal of Computer Vision*, 2004.
2. OpenMP Architecture Review Board, "OpenMP Application Programming Interface," Version 5.0, 2018.
3. Message Passing Interface Forum, "MPI: A Message-Passing Interface Standard," Version 4.0, 2021.
4. Intel Corporation, "IntelÂ® 64 and IA-32 Architectures Optimization Reference Manual," 2023.
5. Anatomy of High-Performance Matrix Multiplication, Kazushige Goto, Robert A. van de Geijn, *ACM Transactions on Mathematical Software*, 2008.

---

**å ±å‘Šå®Œæˆæ—¥æœŸï¼š** 2025/10/16  
**ç¸½ç¨‹å¼ç¢¼è¡Œæ•¸ï¼š** 1,601  
**ç¸½å„ªåŒ–è¿­ä»£æ¬¡æ•¸ï¼š** 15  
**æœ€çµ‚æ•ˆèƒ½ï¼š** ç›¸å°æ–¼åŸºæº–ç‰ˆæœ¬ 1.46x åŠ é€Ÿï¼ˆ31.6% æ”¹å–„ï¼‰

**å ±å‘ŠçµæŸ**
